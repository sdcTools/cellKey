<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the cellKey-Package • cellKey</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the cellKey-Package">
<meta property="og:description" content="cellKey">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cellKey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to the cellKey-Package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sdcTools/userSupport/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to the cellKey-Package</h1>
                        <h4 data-toc-skip class="author">Bernhard
Meindl</h4>
            
            <h4 data-toc-skip class="date">2023-09-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sdcTools/userSupport/blob/HEAD/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="about-the-cellkey-package">About the cellKey package<a class="anchor" aria-label="anchor" href="#about-the-cellkey-package"></a>
</h2>
<p>This package implements methods to provide perturbation for
statistical tables. The implementation if greatly inspired by the the
paper <em>Methodology for the Automatic Confidentialisation of
Statistical Outputs from Remote Servers at the Australian Bureau of
Statistics</em> (Thompson, Broadfoot, Elazar). This approach however was
generalized and a new specification on how record keys are specified and
the lookup-tables are defined is used. This package makes usage of
perturbation tables that can be defined in the <a href="https://github.com/sdcTools/ptable" class="external-link"><strong>ptable</strong></a>
package. This document describes the usage of version <code>1.0.1</code>
of the package.</p>
</div>
<div class="section level2">
<h2 id="main-features">Main Features<a class="anchor" aria-label="anchor" href="#main-features"></a>
</h2>
<p>In the <strong>cellKey</strong> package it is possible to pertub
multidimensional count and magnitude tables. Functionality to generate
suitable record keys is provided in function
<code><a href="../reference/ck_generate_rkeys.html">ck_generate_rkeys()</a></code>. Using sha1-checksums on the input
datasets, we can make sure that the same record keys are generated
whenever the same input data set is used for which record keys should be
generated. However, it is also possible of course to use already
pre-generated record keys available as variable in the microdata
set.</p>
<p>The package allows to make use of sampling weights. Thus, both
weighted and unweighted count and magnitude tables can be perturbed. The
hierarchical structure of the variables spanning the table can be
arbitrarily complex. To generate these hierarchies, the
<strong>cellKey</strong> packages depends on functionality available in
package <a href="https://cran.r-project.org/package=sdcHierarchies" class="external-link"><strong>sdcHierarchies</strong></a>.
Finally, auxiliary methods are provided that allow to extract valuable
information from objects created by the main function of this package
<code>perturbTable()</code>. For example <code>mod_counts()</code>
returns a data object showing for each cell the perturbation value and
where it was found in the lookup table.</p>
<p>What is left is of course identifying bugs and issues and also to
optimize performance of the package as well as to include some real
world examples, eg. census tables.</p>
</div>
<div class="section level2">
<h2 id="an-example">An Example<a class="anchor" aria-label="anchor" href="#an-example"></a>
</h2>
<p>We now show the capabilities of the <strong>cellKey</strong> package
by running an example that</p>
<div class="section level3">
<h3 id="load-the-package">Load the Package<a class="anchor" aria-label="anchor" href="#load-the-package"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sdcTools/cellKey" class="external-link">cellKey</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"cellKey"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] '1.0.1'</span></span></code></pre>
<p>The first step in this approach is to generate a statistical table,
which can be achieved using <code>ck_setup</code>. This function
generates an object that contains all the information required to
perturb count- (and optionally continuously scaled) variables. There are
however a few inputs that <code><a href="../reference/cellkey_pkg.html">ck_setup()</a></code> requires and that need
to be generated beforehand. These inputs are:</p>
<ul>
<li>
<code>x</code>: a <code>data.frame</code> or <code>data.table</code>
containing microdata</li>
<li>
<code>rkey</code>: defines where to find or how to compute record
keys. It is possible to either specify a scalar character name or a
number. If a number is specified, record keys are internally created by
sampling from a uniform distribution between 0 and 1 with the random
numbers rounded to the specified value of digits. If a name is
specified, this name is interpreted as a variable name within
<code>x</code> already containing record keys.</li>
<li>
<code>dims</code>: a named list where each list element contains a
hierarchy created with functionality from package <a href="https://cran.r-project.org/package=sdcHierarchies" class="external-link"><strong>sdcHierarchies</strong></a>
and each name refers to a variable in <code>x</code>
</li>
<li>
<code>w</code>: either <code>NULL</code> (no weights) or the name of
a variable in <code>x</code> that contains weights</li>
<li>
<code>countvars</code>: an optional character vector of variables in
<code>x</code> holding counts. In any case a special count variable
<code>total</code> is internally generated that is <code>1</code> for
each row of <code>x</code>
</li>
<li>
<code>numvars</code>: an optional character vector of variables in
<code>x</code> holding numerical variables that can later be
perturbed.</li>
</ul>
<p>We continue to show how to generate the required inputs. The first
step is to prepare the inputdata.</p>
</div>
<div class="section level3">
<h3 id="specifying-inputdata">Specifying inputdata<a class="anchor" aria-label="anchor" href="#specifying-inputdata"></a>
</h3>
<p>The testdata set we are using in this example contains information on
person-level along with sampling weights as well as some categorical and
continuously scaled variables. We also compute some binary variables for
which we also want to create perturbed tables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ck_create_testdata.html">ck_create_testdata</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span>, <span class="st">"savings"</span>, <span class="st">"income"</span>, <span class="st">"sampling_weight"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">dat</span><span class="op">[</span>, <span class="va">cnt_highincome</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">income</span> <span class="op">&gt;=</span> <span class="fl">9000</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We are now adding record keys (which will be referenced later) with 7
digits to the data set using function <code>ck_generate_rkeys</code> as
shown below:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span><span class="op">$</span><span class="va">rkeys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ck_generate_rkeys.html">ck_generate_rkeys</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">dat</span>, nr_digits <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       sex        age savings income sampling_weight cnt_highincome     rkeys</span></span>
<span><span class="co">## 1:   male age_group3      12   5780              82              0 0.4661863</span></span>
<span><span class="co">## 2: female age_group3      28   2530              79              0 0.9874952</span></span>
<span><span class="co">## 3:   male age_group1     550   6920              82              0 0.4239556</span></span>
<span><span class="co">## 4:   male age_group1     870   7960              90              0 0.2587968</span></span>
<span><span class="co">## 5:   male age_group4      20   9030              29              1 0.3641189</span></span>
<span><span class="co">## 6: female age_group3     102   3290              79              0 0.8286813</span></span></code></pre>
<p>To ensure that the same record keys are computed each and every time
for the same data set, a seed based on the sha1-hash of the input
dataset is computed by default in <code>ck_generate_rkeys</code>. This
seed is used before sampling the record keys and may be overwritten
using the <code>seed</code> argument.</p>
<p>The goal of this introduction is to create a perturbed table of
counts of variables <code>sex</code> by <code>age</code> for all
observations as well as for the subgroups given by
<code>cnt_highincome</code> that are non-zero. We also want to create
perturbed tables of continously scaled variables <code>savings</code>
and <code>income</code> also giving the hierarchical structure defined
by <code>sex</code> by <code>age</code>.</p>
</div>
<div class="section level3">
<h3 id="specifying-dimensions">Specifying dimensions<a class="anchor" aria-label="anchor" href="#specifying-dimensions"></a>
</h3>
<p>It is required to define hierarchies for each of the classifying
variables of the desired table. There are two ways how the hierarchical
structure of these variables (including sub-totals) can be specified.
One way is to use <code>"@; value</code> format as (also) used in <a href="https://cran.r-project.org/package=sdcTable" class="external-link"><strong>sdcTable</strong></a>.
We would suggest however, to use the second alternative which is using
functionality from package <a href="https://cran.r-project.org/package=sdcHierarchies" class="external-link"><strong>sdcHierarchies</strong></a>.
In this vignette, we only show the preferred way to generate hierarchies
for categorical variables <code>age</code> and <code>sex</code>
below:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dim_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_create.html" class="external-link">hier_create</a></span><span class="op">(</span>root <span class="op">=</span> <span class="st">"Total"</span>, nodes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_display.html" class="external-link">hier_display</a></span><span class="op">(</span><span class="va">dim_sex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Total</span></span>
<span><span class="co">## ├─male</span></span>
<span><span class="co">## └─female</span></span></code></pre>
<p>For variable <code>age</code> the process is very much the same:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dim_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_create.html" class="external-link">hier_create</a></span><span class="op">(</span>root <span class="op">=</span> <span class="st">"Total"</span>, nodes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"age_group"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_display.html" class="external-link">hier_display</a></span><span class="op">(</span><span class="va">dim_age</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Total</span></span>
<span><span class="co">## ├─age_group1</span></span>
<span><span class="co">## ├─age_group2</span></span>
<span><span class="co">## ├─age_group3</span></span>
<span><span class="co">## ├─age_group4</span></span>
<span><span class="co">## ├─age_group5</span></span>
<span><span class="co">## └─age_group6</span></span></code></pre>
<p>The idea of <a href="https://github.com/bernhard-da/sdcHierarchies" class="external-link"><strong>sdcHierarchies</strong></a>
is to create a tree object using <code><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_create.html" class="external-link">hier_create()</a></code> and then add
(using <code><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_add.html" class="external-link">hier_add()</a></code>), delete (with
<code><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_delete.html" class="external-link">hier_delete()</a></code>) or rename (using <code><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_rename.html" class="external-link">hier_rename()</a></code>)
elements from this hierarchical structure. For more examples have a look
at the package vignette of the package which can be accessed with
<code><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_vignette.html" class="external-link">sdcHierarchies::hier_vignette()</a></code>. <a href="https://github.com/bernhard-da/sdcHierarchies" class="external-link"><strong>sdcHierarchies</strong></a>
also contains a shiny-based app that can be called with
<code><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_app.html" class="external-link">hier_app()</a></code> which allows to interactively change and modify
a hierarchy and allows to convert tree- and data.frame based inputs into
various formats. For more information, have a look at
<code><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_app.html" class="external-link">?hier_app</a></code> and the other help-files of the package.</p>
<p>After all dimensions have been specified, these inputs must then be
combined into a named list. In this object, the list-names refer to
variable names of the input data set and the elements the data objects
that hold the hierarchy specification itself. This is why the list
elements of <code>dims</code> in this example have to be named
<code>sex</code> and <code>age</code> as the specification refers to
variables <code>age</code> and <code>sex</code> in input set
<code>dat</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="va">dim_sex</span>, age <span class="op">=</span> <span class="va">dim_age</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="setup-a-table-instance">Setup a table instance<a class="anchor" aria-label="anchor" href="#setup-a-table-instance"></a>
</h3>
<p>We now have prepared the inputs and can define a generic statistical
table using <code><a href="../reference/cellkey_pkg.html">ck_setup()</a></code> as shown below:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cellkey_pkg.html">ck_setup</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  rkey <span class="op">=</span> <span class="st">"rkeys"</span>,</span>
<span>  dims <span class="op">=</span> <span class="va">dims</span>,</span>
<span>  w <span class="op">=</span> <span class="st">"sampling_weight"</span>,</span>
<span>  countvars <span class="op">=</span> <span class="st">"cnt_highincome"</span>,</span>
<span>  numvars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span>, <span class="st">"savings"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/cellkey_pkg.html">ck_setup()</a></code> returns a <code>R6</code> class object that
contains not only the relevant data but also all available methods.
Thus, it is not required to assign the results of such methods to new
objects, instead, the object itself is automatically updated.</p>
<p>These objects also have a custom print method, showing some general
information about the object:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ── Table Information ───────────────────────────────────────────────────────────</span></span>
<span><span class="co">## ✔ 21 cells in 2 dimensions ('sex', 'age')</span></span>
<span><span class="co">## ✔ weights: yes</span></span>
<span><span class="co">## ── Tabulated / Perturbed countvars ─────────────────────────────────────────────</span></span>
<span><span class="co">## ☐ 'total'</span></span>
<span><span class="co">## ☐ 'cnt_highincome'</span></span>
<span><span class="co">## ── Tabulated / Perturbed numvars ───────────────────────────────────────────────</span></span>
<span><span class="co">## ☐ 'income'</span></span>
<span><span class="co">## ☐ 'savings'</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="defining-perturbation-parameters">Defining perturbation parameters<a class="anchor" aria-label="anchor" href="#defining-perturbation-parameters"></a>
</h3>
<div class="section level4">
<h4 id="perturbation-parameters-for-count-variables">Perturbation parameters for count variables<a class="anchor" aria-label="anchor" href="#perturbation-parameters-for-count-variables"></a>
</h4>
<p>The next task is to define parameters that are used to perturb count
variables which can be achieved with <code>ck_params_cnts</code>. This
function requires as input the result of either
<code>pt_create_pParams</code>, <code>pt_create_pTable</code> or
<code>create_cnt_ptable</code> from the <a href="https://github.com/sdcTools/ptable" class="external-link"><strong>ptable</strong></a>
package. Please refer also to the documentation of this package for
information on the required parameters. In this example we are going to
use - amongst others - exemplary ptables that can are provided by the
<code>ptable</code>-pkg for demonstration purposes:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># two different perturbation parameter sets from the ptable-pkg</span></span>
<span><span class="co"># an example ptable provided directly</span></span>
<span><span class="va">ptab1</span> <span class="op">&lt;-</span> <span class="fu">ptable</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ptable/man/pt_ex_cnts.html" class="external-link">pt_ex_cnts</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># creating a ptable by specifying parameters</span></span>
<span><span class="va">para2</span> <span class="op">&lt;-</span> <span class="fu">ptable</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ptable/man/ptable_pkg.html" class="external-link">create_cnt_ptable</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="fl">8</span>, V <span class="op">=</span> <span class="fl">3</span>, js <span class="op">=</span> <span class="fl">2</span>, pstay <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>  optim <span class="op">=</span> <span class="fl">1</span>, mono <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We then need to create the required inputs for the cellKey
package.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_cnts1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ck_params_cnts.html">ck_params_cnts</a></span><span class="op">(</span>ptab <span class="op">=</span> <span class="va">ptab1</span><span class="op">)</span></span>
<span><span class="va">p_cnts2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ck_params_cnts.html">ck_params_cnts</a></span><span class="op">(</span>ptab <span class="op">=</span> <span class="va">para2</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/ck_params_cnts.html">ck_params_cnts()</a></code> returns objects that can be used as
inputs in method <code>params_cnts_set()</code>. In argument
<code>v</code> one may specify count variables for which the supplied
perturbation parameters should be used. If <code>v</code> is not
specified, the perturbation parameters are used for all count
variables.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use `p_cnts1` for variable "total" (which always exists)</span></span>
<span><span class="va">tab</span><span class="op">$</span><span class="fu">params_cnts_set</span><span class="op">(</span>val <span class="op">=</span> <span class="va">p_cnts1</span>, v <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## --&gt; setting perturbation parameters for variable 'total'</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use `p_cnts2` for "cnt_highincome"</span></span>
<span><span class="va">tab</span><span class="op">$</span><span class="fu">params_cnts_set</span><span class="op">(</span>val <span class="op">=</span> <span class="va">p_cnts2</span>, v <span class="op">=</span> <span class="st">"cnt_highincome"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## --&gt; setting perturbation parameters for variable 'cnt_highincome'</span></span></code></pre>
<p>It is therefore entirely possible to use different parameter sets for
different variables. Modifying perturbation parameters for some
variables is easy, too. It is only required to apply the
<code>params_cnts_set()</code>-method again which will replace any
previously defined parameters.</p>
</div>
<div class="section level4">
<h4 id="perturbation-parameters-for-continuous-variables">Perturbation parameters for continuous variables<a class="anchor" aria-label="anchor" href="#perturbation-parameters-for-continuous-variables"></a>
</h4>
<p>Setting and defining perturbation parameters for continuous variables
works similarily. The required functions are
<code>ck_params_num()</code> to create input objects that can be set
with the <code>params_nums_set</code> method. Please note that it is
possibly by specifying the <code>path</code> argument in both
<code><a href="../reference/ck_params_nums.html">ck_params_nums()</a></code> and <code><a href="../reference/ck_params_cnts.html">ck_params_cnts()</a></code> to save
the parameters additionally as yaml-file. Using
<code><a href="../reference/ck_read_yaml.html">ck_read_yaml()</a></code>, these files can later be imported again.
This feature is useful for re-using parameter settings.</p>
<p>The underlying framework on how to perturb continuous tables differs
from the proposed method from <code>ABS</code>. One possible approach is
based on a <em>“flex function”</em>. This approach (which is described
in deliverable <code>D4.2</code> in the project <a href="https://ec.europa.eu/eurostat/cros/content/perturbative-confidentiality-methods_en" class="external-link">perturbative
confidentiality methods</a> allows to apply different magnitude of noise
to larger and smaller cells. Users can define the required parameters
for the flex-approach with function <code><a href="../reference/ck_flexparams.html">ck_flexparams()</a></code>. The
required inputs are:</p>
<ul>
<li>
<code>fp</code>: the flexpoint defining at which point should the
underlying noise coefficient function reach its desired maximum (which
is defined by the first element of <code>p</code>)</li>
<li>
<code>p</code>: numeric vector of length <code>2</code> with
<code>p[1] &gt; p[2]</code> where both elements specify a percentage.
The first value refers to the desired maximum perturbation percentage
for small cells (depending on fp) while the second element refers to the
desired maximum perturbation percentage for large cells.</li>
<li>
<code>epsilon</code>: a numeric vector in descending order with all
values in <code>[0; 1]</code> and with the first element forced to equal
<code>1</code>. The length of this parameter must correspond with the
number of <code>top_k</code> specified in <code><a href="../reference/ck_params_nums.html">ck_params_nums()</a></code>
(which will be discussed later).</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># parameters for the flex-function</span></span>
<span><span class="va">p_flex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ck_flexparams.html">ck_flexparams</a></span><span class="op">(</span></span>
<span>  fp <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.03</span><span class="op">)</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In the <a href="https://github.com/sdcTools/cellKey" class="external-link"><strong>cellKey</strong></a>
package it is possible to select the underlying data that form the base
for the perturbation differently. In <code><a href="../reference/ck_params_nums.html">ck_params_nums()</a></code> the
specific approach can be selected in argument <code>type</code>. The
valid choices for this argument are:</p>
<ul>
<li>
<code>"top_contr"</code>: the <code>k</code> largest contributions
to each cell are used in the perturbation procedure with the number
<code>k</code> required to be specified in argument
<code>top_k</code>
</li>
<li>
<code>"mean"</code>: weighted cellmeans are used as starting
points</li>
<li>
<code>"range"</code>: the difference between largest and smallest
unweighted contributions for each cell are used as base for the
perturbation procedure</li>
<li>
<code>"sum"</code>: weighted cellvalues are used as starting points
for the perturbation</li>
</ul>
<p>Another, more basic approach, is to use a constant perturbation
magnitude for all cells, independent on their (weighted) values. The
required parameters can be defined with <code><a href="../reference/ck_simpleparams.html">ck_simpleparams()</a></code>
as shown below:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># parameters for the simple approach</span></span>
<span><span class="va">p_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ck_simpleparams.html">ck_simpleparams</a></span><span class="op">(</span></span>
<span>  p <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>In this appraoch it is only required to specify a single percentage
value <code>p</code> and - as in the case for the flex function - a
vector of epsilons that are used in the case when
<code>top_k &gt; 1</code>.</p>
<p>Further important parameters for <code><a href="../reference/ck_params_nums.html">ck_params_nums()</a></code>
are:</p>
<ul>
<li>
<code>mu_c</code>: an extra amount of perturbation applied to
sensitive cells (restricted to the first of <code>top_k</code> noise
components). In the following example we demonstrate how to identify
sensitive cells for numeric variables.</li>
<li>
<code>same_key</code>: a logical value specifying if the original
cell key (<code>TRUE</code>) should be used for the lookup of the
largest contributor of a cell or if a perturbation of the cellkey itself
(<code>FALSE</code>) should take place.</li>
<li>
<code>use_zero_rkeys</code>: a logical value defining if record keys
of units not contributing to a specific numeric variables should be used
(<code>TRUE</code>) or ignored (<code>FALSE</code>) when cell keys are
computed.</li>
</ul>
<p>A very important parameter is <code>ptab</code> which actually holds
the perturbation tables in which perturbation values are looked up. This
input can be specified differently in the case when numeric variables
should be perturbed. It can be either an object derived from
<code>ptable::pt_create_pTable(..., table = "nums")</code> in the most
simple case. More advanced is to supply a named list, where the allowed
names are shown below and each element must be the output of
<code>ptable::pt_create_pTable(..., table = "nums")</code>.</p>
<ul>
<li>
<code>"all"</code>: this ptable will be used for all cells; if
specified, list-elements named <code>"even"</code>or <code>"odd"</code>
are ignored</li>
<li>
<code>"even"</code>: this perturbation table will be used to look up
perturbation values for cells with an even number of contributors</li>
<li>
<code>"odd"</code>: will be used to look up perturbation values for
cells with an odd number of contributors</li>
<li>
<code>"small_cells"</code>: if specified, this ptable will be used
to extract perturbation values for very small cells</li>
</ul>
<p>Please note, that if the goal is to have different perturbation
tables for cells with an even/odd number of contributors, both
<code>"even"</code> or <code>"odd"</code> must be available in the input
list. In the chunk below we create four different perturbation tables.
For details on the parameters, please look at the documentation of the
<a href="https://github.com/sdcTools/ptable" class="external-link"><code>ptable</code></a>
package, especially in <code><a href="https://rdrr.io/pkg/ptable/man/ptable_pkg.html" class="external-link">ptable::create_num_ptable()</a></code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># same ptable for all cells except for very small ones</span></span>
<span><span class="va">ex_ptab1</span> <span class="op">&lt;-</span> <span class="fu">ptable</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ptable/man/pt_ex_nums.html" class="external-link">pt_ex_nums</a></span><span class="op">(</span>parity <span class="op">=</span> <span class="cn">TRUE</span>, separation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We can now use these tables to finally create objects containing all
the required information to create perturbed magnitude tables using
<code>ck_params_nums</code>. In the first case we want the same
perturbation table (<code>ptab_all</code>) for cells with an even/odd
number of contributors but want to use <code>ptab_sc</code> for very
small cells.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_nums1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ck_params_nums.html">ck_params_nums</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"top_contr"</span>,</span>
<span>  top_k <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  ptab <span class="op">=</span> <span class="va">ex_ptab1</span>,</span>
<span>  mult_params <span class="op">=</span> <span class="va">p_flex</span>,</span>
<span>  mu_c <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  same_key <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  use_zero_rkeys <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The second input we generate should use different ptables for cells
with an even/odd number of contributing units (<code>ptab_even</code>
and <code>ptab_odd</code>) but should not use a specific perturbation
table for very small cells.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_ptab2</span> <span class="op">&lt;-</span> <span class="fu">ptable</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ptable/man/pt_ex_nums.html" class="external-link">pt_ex_nums</a></span><span class="op">(</span>parity <span class="op">=</span> <span class="cn">FALSE</span>, separation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>As above, we need to use <code><a href="../reference/ck_params_nums.html">ck_params_nums()</a></code> to compute
suitable inputs.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_nums2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ck_params_nums.html">ck_params_nums</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  ptab <span class="op">=</span> <span class="va">ex_ptab2</span>,</span>
<span>  mult_params <span class="op">=</span> <span class="va">p_simple</span>,</span>
<span>  mu_c <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  same_key <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  use_zero_rkeys <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The package internally computes the separation point that is used for
very small cells in case this is required. Details on this can also be
found in deliverable <a href="https://ec.europa.eu/eurostat/cros/content/perturbative-confidentiality-methods_en" class="external-link"><code>D4.2</code></a>.</p>
<p>Now we can attach the results from <code><a href="../reference/ck_params_nums.html">ck_params_nums()</a></code> to
numeric variables using the <code>params_nums_set()</code>-method as
shown below:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span><span class="op">$</span><span class="fu">params_nums_set</span><span class="op">(</span>v <span class="op">=</span> <span class="st">"income"</span>, val <span class="op">=</span> <span class="va">p_nums1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## --&gt; setting perturbation parameters for variable 'income'</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span><span class="op">$</span><span class="fu">params_nums_set</span><span class="op">(</span>v <span class="op">=</span> <span class="st">"savings"</span>, val <span class="op">=</span> <span class="va">p_nums1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## --&gt; setting perturbation parameters for variable 'savings'</span></span></code></pre>
<p>In order to make use of parameter <code>mu_c</code> that allows ab
add extra amount of protection to sensitive cells, one may identify
sensitive cells according to some rules. The following methods to
identify sensitive cells are implemented:</p>
<ul>
<li>
<code>supp_p()</code>: identify sensitive cells based on
p%-rule</li>
<li>
<code>supp_pp()</code>: identify sensitive cells based on
pq%-rule</li>
<li>
<code>supp_nk()</code>: identify sensitive cells based on
nk-dominance rule</li>
<li>
<code>supp_freq()</code>: identify sensitive cells based on minimal
frequencies for (weighted) number of contributors</li>
<li>
<code>supp_val()</code>: identify sensitive cells based on
(weighted) cell values</li>
<li>
<code>supp_cells()</code>: identify sensitive cells based on their
“names”</li>
</ul>
<p>We now want to set all cells for variable <code>income</code> as
sensitive to which less than <code>15</code> units contribute.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span><span class="op">$</span><span class="fu">supp_freq</span><span class="op">(</span>v <span class="op">=</span> <span class="st">"income"</span>, n <span class="op">=</span> <span class="fl">15</span>, weighted <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## freq-rule: 3 new sensitive cells (incl. duplicates) found (total: 3)</span></span></code></pre>
<p>To set specific cells independent on values but their names, one may
use the <code>$supp_cells()</code>-method. This cell requires a
<code>data.frame</code> as input that contains a column for each
dimensional variable specified. Each row of this input is considered as
a cell where <code>NAs</code> are used as placeholders that match any
characteristic of the relevant variable. Using the
<code>data.frame</code> <code>inp</code> show below, the programm would
suppress the following cells:</p>
<ul>
<li>
<code>female</code> x <code>age_group1</code>
</li>
<li>
<code>male</code> x <code>age_group3</code>
</li>
<li>
<code>male</code> x any age group available in the data</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">"sex"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span>, <span class="st">"male"</span><span class="op">)</span>,</span>
<span>  <span class="st">"age"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_group1"</span>, <span class="st">"age_group3"</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="compute-perturbed-tables">Compute perturbed tables<a class="anchor" aria-label="anchor" href="#compute-perturbed-tables"></a>
</h3>
<p>It is now possible to finally perturbed variables using the
<code>perturb()</code>-method. As <code>tab</code> - the object created
with <code><a href="../reference/cellkey_pkg.html">ck_setup()</a></code> - already contains all possible data, the
only required input is the name of a variable that should be
perturbed.</p>
<ul>
<li>
<code>v</code>: a character vector specifying one or more variables
that should be perturbed.</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span><span class="op">$</span><span class="fu">perturb</span><span class="op">(</span>v <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Count variable 'total' was perturbed.</span></span></code></pre>
<p>After this call, object <code>tab</code> is updated and contains now
also perturbed values for variable <code>total</code>. We note that no
explicit assignment is required. The following code shows that we also
can perturb cnt- and numerical variables in one single call.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span><span class="op">$</span><span class="fu">perturb</span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cnt_highincome"</span>, <span class="st">"savings"</span>, <span class="st">"income"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Count variable 'cnt_highincome' was perturbed.</span></span></code></pre>
<pre><code><span><span class="co">## Numeric variable 'savings' was perturbed.</span></span></code></pre>
<pre><code><span><span class="co">## Numeric variable 'income' was perturbed.</span></span></code></pre>
<p>A <code>data.table</code> containing original and perturbed values
can now be extracted using the <code>freqtab()</code>- and
<code>numtab()</code> methods as discussed next.</p>
</div>
<div class="section level3">
<h3 id="extracting-results">Extracting results<a class="anchor" aria-label="anchor" href="#extracting-results"></a>
</h3>
<div class="section level4">
<h4 id="obtain-perturbed-tables-for-count-tables">Obtain perturbed tables for count tables<a class="anchor" aria-label="anchor" href="#obtain-perturbed-tables-for-count-tables"></a>
</h4>
<p>Applying the <code>freqtab()</code>-method to one ore more already
perturbed variables returns a <code>data.table</code> that contains for
each table cell the unpertubed and perturbed (weighted and/or
unweighted) counts. This function has the following arguments:</p>
<ul>
<li>
<code>v</code>: one or more variable names of already perturbed
count variables</li>
<li>
<code>path</code>: if not <code>NULL</code>, a (relative or
absolute) path to which the resulting output table should be written. A
<code>csv</code> file will be generated and <code>.csv</code> will be
appended to the value provided.</li>
</ul>
<p>The method returns a <code>data.table</code> with all combinations of
the dimensional variables in the first <span class="math inline">\(n\)</span> columns and after those the following
columns:</p>
<ul>
<li>
<code>vname</code>: name of the perturbed variable</li>
<li>
<code>uwc</code>: unweighted counts</li>
<li>
<code>wc</code>: weighted counts</li>
<li>
<code>puwc</code>: perturbed unweighted counts</li>
<li>
<code>pwc</code>: perturbed weighted counts</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span><span class="op">$</span><span class="fu">freqtab</span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total"</span>, <span class="st">"cnt_highincome"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        sex        age          vname  uwc     wc puwc         pwc</span></span>
<span><span class="co">##  1:  Total      Total          total 4580 275476 4579 275415.8524</span></span>
<span><span class="co">##  2:  Total age_group1          total 1969 118014 1969 118014.0000</span></span>
<span><span class="co">##  3:  Total age_group2          total 1143  69040 1144  69100.4024</span></span>
<span><span class="co">##  4:  Total age_group3          total  864  51985  865  52045.1678</span></span>
<span><span class="co">##  5:  Total age_group4          total  423  25241  423  25241.0000</span></span>
<span><span class="co">##  6:  Total age_group5          total  168  10361  169  10422.6726</span></span>
<span><span class="co">##  7:  Total age_group6          total   13    835   11    706.5385</span></span>
<span><span class="co">##  8:   male      Total          total 2296 137191 2297 137250.7522</span></span>
<span><span class="co">##  9:   male age_group1          total 1015  60681 1016  60740.7842</span></span>
<span><span class="co">## 10:   male age_group2          total  571  34112  570  34052.2592</span></span>
<span><span class="co">## 11:   male age_group3          total  424  24998  425  25056.9575</span></span>
<span><span class="co">## 12:   male age_group4          total  195  11912  195  11912.0000</span></span>
<span><span class="co">## 13:   male age_group5          total   84   5004   85   5063.5714</span></span>
<span><span class="co">## 14:   male age_group6          total    7    484    7    484.0000</span></span>
<span><span class="co">## 15: female      Total          total 2284 138285 2284 138285.0000</span></span>
<span><span class="co">## 16: female age_group1          total  954  57333  955  57393.0975</span></span>
<span><span class="co">## 17: female age_group2          total  572  34928  572  34928.0000</span></span>
<span><span class="co">## 18: female age_group3          total  440  26987  441  27048.3341</span></span>
<span><span class="co">## 19: female age_group4          total  228  13329  229  13387.4605</span></span>
<span><span class="co">## 20: female age_group5          total   84   5357   85   5420.7738</span></span>
<span><span class="co">## 21: female age_group6          total    6    351    6    351.0000</span></span>
<span><span class="co">## 22:  Total      Total cnt_highincome  445  26924  445  26924.0000</span></span>
<span><span class="co">## 23:  Total age_group1 cnt_highincome  192  11497  191  11437.1198</span></span>
<span><span class="co">## 24:  Total age_group2 cnt_highincome  123   7862  122   7798.0813</span></span>
<span><span class="co">## 25:  Total age_group3 cnt_highincome   82   4829   82   4829.0000</span></span>
<span><span class="co">## 26:  Total age_group4 cnt_highincome   34   1955   32   1840.0000</span></span>
<span><span class="co">## 27:  Total age_group5 cnt_highincome   14    781   14    781.0000</span></span>
<span><span class="co">## 28:  Total age_group6 cnt_highincome    0      0    0      0.0000</span></span>
<span><span class="co">## 29:   male      Total cnt_highincome  219  12988  219  12988.0000</span></span>
<span><span class="co">## 30:   male age_group1 cnt_highincome   90   5289   90   5289.0000</span></span>
<span><span class="co">## 31:   male age_group2 cnt_highincome   66   4137   66   4137.0000</span></span>
<span><span class="co">## 32:   male age_group3 cnt_highincome   41   2350   41   2350.0000</span></span>
<span><span class="co">## 33:   male age_group4 cnt_highincome   15    795   14    742.0000</span></span>
<span><span class="co">## 34:   male age_group5 cnt_highincome    7    417    7    417.0000</span></span>
<span><span class="co">## 35:   male age_group6 cnt_highincome    0      0    0      0.0000</span></span>
<span><span class="co">## 36: female      Total cnt_highincome  226  13936  226  13936.0000</span></span>
<span><span class="co">## 37: female age_group1 cnt_highincome  102   6208  103   6268.8627</span></span>
<span><span class="co">## 38: female age_group2 cnt_highincome   57   3725   57   3725.0000</span></span>
<span><span class="co">## 39: female age_group3 cnt_highincome   41   2479   41   2479.0000</span></span>
<span><span class="co">## 40: female age_group4 cnt_highincome   19   1160   21   1282.1053</span></span>
<span><span class="co">## 41: female age_group5 cnt_highincome    7    364    4    208.0000</span></span>
<span><span class="co">## 42: female age_group6 cnt_highincome    0      0    0      0.0000</span></span>
<span><span class="co">##        sex        age          vname  uwc     wc puwc         pwc</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="obtain-perturbed-tables-for-magnitude-tables">Obtain perturbed tables for magnitude tables<a class="anchor" aria-label="anchor" href="#obtain-perturbed-tables-for-magnitude-tables"></a>
</h4>
<p>Using the <code>numtab()</code>-method allows to extract results for
continuous variables. The required inputs are the same as for the
<code>freqtab()</code>-method and the output returns a
<code>data.table</code> with all combinations of the dimensional
variables in the first <span class="math inline">\(n\)</span> columns
and the following additional columns:</p>
<ul>
<li>
<code>vname</code>: name of the perturbed variable</li>
<li>
<code>uws</code>: unweighted sum</li>
<li>
<code>ws</code>: weighted cellsum</li>
<li>
<code>pws</code>: perturbed weighted sum of the given cell</li>
</ul>
<p>We now have a look at the results of the variables
<code>savings</code> and <code>income</code> that we already have
perturbed.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span><span class="op">$</span><span class="fu">numtab</span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"savings"</span>, <span class="st">"income"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        sex        age   vname      uws         ws          pws</span></span>
<span><span class="co">##  1:  Total      Total savings  2273532  137172905  137169142.3</span></span>
<span><span class="co">##  2:  Total age_group1 savings   982386   59018298   59015607.7</span></span>
<span><span class="co">##  3:  Total age_group2 savings   552336   33987180   33982784.3</span></span>
<span><span class="co">##  4:  Total age_group3 savings   437101   26263580   26258600.5</span></span>
<span><span class="co">##  5:  Total age_group4 savings   214661   12616185   12618325.3</span></span>
<span><span class="co">##  6:  Total age_group5 savings    80451    4823803    4828644.1</span></span>
<span><span class="co">##  7:  Total age_group6 savings     6597     463859     468818.6</span></span>
<span><span class="co">##  8:   male      Total savings  1159816   70027301   70031612.7</span></span>
<span><span class="co">##  9:   male age_group1 savings   517660   31097881   31094760.0</span></span>
<span><span class="co">## 10:   male age_group2 savings   280923   17437629   17427046.9</span></span>
<span><span class="co">## 11:   male age_group3 savings   214970   12665415   12668939.8</span></span>
<span><span class="co">## 12:   male age_group4 savings    99420    6036099    6039346.3</span></span>
<span><span class="co">## 13:   male age_group5 savings    43233    2542432    2541050.0</span></span>
<span><span class="co">## 14:   male age_group6 savings     3610     247845     249088.3</span></span>
<span><span class="co">## 15: female      Total savings  1113716   67145604   67141750.7</span></span>
<span><span class="co">## 16: female age_group1 savings   464726   27920417   27914521.8</span></span>
<span><span class="co">## 17: female age_group2 savings   271413   16549551   16552052.7</span></span>
<span><span class="co">## 18: female age_group3 savings   222131   13598165   13593305.0</span></span>
<span><span class="co">## 19: female age_group4 savings   115241    6580086    6585295.6</span></span>
<span><span class="co">## 20: female age_group5 savings    37218    2281371    2284303.5</span></span>
<span><span class="co">## 21: female age_group6 savings     2987     216014     211762.6</span></span>
<span><span class="co">## 22:  Total      Total  income 22952978 1380316246 1380285761.2</span></span>
<span><span class="co">## 23:  Total age_group1  income  9810547  587845915  587822631.7</span></span>
<span><span class="co">## 24:  Total age_group2  income  5692119  348034461  347991138.6</span></span>
<span><span class="co">## 25:  Total age_group3  income  4406946  262519491  262515265.3</span></span>
<span><span class="co">## 26:  Total age_group4  income  2133543  125702686  125711306.4</span></span>
<span><span class="co">## 27:  Total age_group5  income   848151   52076759   52092178.1</span></span>
<span><span class="co">## 28:  Total age_group6  income    61672    4136934    4245183.6</span></span>
<span><span class="co">## 29:   male      Total  income 11262049  668671902  668704307.0</span></span>
<span><span class="co">## 30:   male age_group1  income  4877164  290254413  290236022.2</span></span>
<span><span class="co">## 31:   male age_group2  income  2811379  168133314  168032531.9</span></span>
<span><span class="co">## 32:   male age_group3  income  2168169  126831728  126838909.9</span></span>
<span><span class="co">## 33:   male age_group4  income   978510   57735897   57756332.9</span></span>
<span><span class="co">## 34:   male age_group5  income   393134   23373657   23368269.4</span></span>
<span><span class="co">## 35:   male age_group6  income    33693    2342893    2406397.7</span></span>
<span><span class="co">## 36: female      Total  income 11690929  711644344  711610114.8</span></span>
<span><span class="co">## 37: female age_group1  income  4933383  297591502  297516432.1</span></span>
<span><span class="co">## 38: female age_group2  income  2880740  179901147  179920338.8</span></span>
<span><span class="co">## 39: female age_group3  income  2238777  135687763  135650588.9</span></span>
<span><span class="co">## 40: female age_group4  income  1155033   67966789   68110900.6</span></span>
<span><span class="co">## 41: female age_group5  income   455017   28703102   28721396.7</span></span>
<span><span class="co">## 42: female age_group6  income    27979    1794041    1706376.5</span></span>
<span><span class="co">##        sex        age   vname      uws         ws          pws</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="utility-measures">Utility-measures<a class="anchor" aria-label="anchor" href="#utility-measures"></a>
</h3>
<div class="section level4">
<h4 id="utility-measures-for-count-variables">Utility measures for count variables<a class="anchor" aria-label="anchor" href="#utility-measures-for-count-variables"></a>
</h4>
<p>Method <code>measures_cnts()</code> allows to compute information
loss measures for perturbed count variables. Its application is as
simple as:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span><span class="op">$</span><span class="fu">measures_cnts</span><span class="op">(</span>v <span class="op">=</span> <span class="st">"total"</span>, exclude_zeros <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $overview</span></span>
<span><span class="co">##    noise cnt        pct</span></span>
<span><span class="co">## 1:    -1  11 0.52380952</span></span>
<span><span class="co">## 2:     0   7 0.33333333</span></span>
<span><span class="co">## 3:     1   2 0.09523810</span></span>
<span><span class="co">## 4:     2   1 0.04761905</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $measures</span></span>
<span><span class="co">##       what    d1    d2    d3</span></span>
<span><span class="co">##  1:    Min 0.000 0.000 0.000</span></span>
<span><span class="co">##  2:    Q10 0.000 0.000 0.000</span></span>
<span><span class="co">##  3:    Q20 0.000 0.000 0.000</span></span>
<span><span class="co">##  4:    Q30 0.000 0.000 0.000</span></span>
<span><span class="co">##  5:    Q40 1.000 0.000 0.010</span></span>
<span><span class="co">##  6:   Mean 0.714 0.009 0.030</span></span>
<span><span class="co">##  7: Median 1.000 0.001 0.016</span></span>
<span><span class="co">##  8:    Q60 1.000 0.001 0.017</span></span>
<span><span class="co">##  9:    Q70 1.000 0.002 0.024</span></span>
<span><span class="co">## 10:    Q80 1.000 0.004 0.033</span></span>
<span><span class="co">## 11:    Q90 1.000 0.012 0.054</span></span>
<span><span class="co">## 12:    Q95 1.000 0.012 0.054</span></span>
<span><span class="co">## 13:    Q99 1.800 0.125 0.242</span></span>
<span><span class="co">## 14:    Max 2.000 0.154 0.289</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $cumdistr_d1</span></span>
<span><span class="co">##    cat cnt       pct</span></span>
<span><span class="co">## 1:   0   7 0.3333333</span></span>
<span><span class="co">## 2:   1  20 0.9523810</span></span>
<span><span class="co">## 3:   2  21 1.0000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $cumdistr_d2</span></span>
<span><span class="co">##            cat cnt      pct</span></span>
<span><span class="co">## 1:    [0,0.02]  20 0.952381</span></span>
<span><span class="co">## 2: (0.02,0.05]  20 0.952381</span></span>
<span><span class="co">## 3:  (0.05,0.1]  20 0.952381</span></span>
<span><span class="co">## 4:   (0.1,0.2]  21 1.000000</span></span>
<span><span class="co">## 5:   (0.2,0.3]  21 1.000000</span></span>
<span><span class="co">## 6:   (0.3,0.4]  21 1.000000</span></span>
<span><span class="co">## 7:   (0.4,0.5]  21 1.000000</span></span>
<span><span class="co">## 8:   (0.5,Inf]  21 1.000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $cumdistr_d3</span></span>
<span><span class="co">##            cat cnt       pct</span></span>
<span><span class="co">## 1:    [0,0.02]  13 0.6190476</span></span>
<span><span class="co">## 2: (0.02,0.05]  18 0.8571429</span></span>
<span><span class="co">## 3:  (0.05,0.1]  20 0.9523810</span></span>
<span><span class="co">## 4:   (0.1,0.2]  20 0.9523810</span></span>
<span><span class="co">## 5:   (0.2,0.3]  21 1.0000000</span></span>
<span><span class="co">## 6:   (0.3,0.4]  21 1.0000000</span></span>
<span><span class="co">## 7:   (0.4,0.5]  21 1.0000000</span></span>
<span><span class="co">## 8:   (0.5,Inf]  21 1.0000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $false_zero</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $false_nonzero</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $exclude_zeros</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre>
<p>This function returns a list with several utility measures that are
now discussed. For further information have a look at
<code><a href="../reference/ck_cnt_measures.html">?ck_cnt_measures</a></code> as the same set of measures can also be
computed for two vectors containing original and perturbed values.</p>
<ul>
<li>
<code>overview</code>: a <code>data.table</code> with the following
three columns:
<ul>
<li>noise: amount of noise computed as orig - pert</li>
<li>cnt: number of cells perturbed with the value given in column
noise</li>
<li>pct: percentage of cells perturbed with the value given in column
noise</li>
</ul>
</li>
<li>
<code>measures</code>: a <code>data.table</code> containing measures
of the distribution of three different distances between original and
perturbed values of the unweighted counts. Column <code>what</code>
specifies the computed measure. The three distances considered are:
<ul>
<li>
<code>d1</code>: absolute distance between original and masked
values</li>
<li>
<code>d2</code>: relative absolute distance between original and
masked values</li>
<li>
<code>d3</code>: absolute distance between square-roots of original
and perturbed values</li>
</ul>
</li>
<li>
<code>cumdistr_d1</code>, <code>cumdistr_d2</code> and
<code>cumdistr_d3</code>: for each distance d1, d2 and d3, a data.table
with the following three columns:
<ul>
<li>
<code>cat</code>: a specific value (for d1) or interval (for
distances d2 and d3)</li>
<li>
<code>cnt</code>: number of records smaller or equal the value in
column cat for the given distance</li>
<li>
<code>pct</code>: proportion of records smaller or equal the value
in column cat for the selected distance</li>
</ul>
</li>
<li>
<code>false_zero</code>: number of cells that were perturbed to
zero</li>
<li>
<code>false_nonzero</code>: number of cells that were initially zero
but have been perturbed to a number different from zero</li>
</ul>
<p>If argument <code>exclude_zeros</code> is <code>TRUE</code> (the
default setting), empty cells are excluded when computing distance-based
measures <code>d1</code>, <code>d2</code> and <code>d3</code>.</p>
</div>
<div class="section level4">
<h4 id="utility-measures-for-continuous-variables">Utility measures for continuous variables<a class="anchor" aria-label="anchor" href="#utility-measures-for-continuous-variables"></a>
</h4>
<p>For now, no utility measures for continuous variables are available.
This will change in a future version.</p>
</div>
</div>
<div class="section level3">
<h3 id="additional-features">Additional Features<a class="anchor" aria-label="anchor" href="#additional-features"></a>
</h3>
<p>Finally we note that there are <code>print</code> and
<code>summary</code> methods implemented for objects created with from
<code><a href="../reference/cellkey_pkg.html">ck_setup()</a></code> which can be used as shown below:</p>
<p>The <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>-method shows the dimension of the table as
well as the variables that are (or possibly can be) perturbed. It is
also displayed if the table was constructed using weights.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span> <span class="co"># same as (print(tab))</span></span></code></pre></div>
<pre><code><span><span class="co">## ── Table Information ───────────────────────────────────────────────────────────</span></span>
<span><span class="co">## ✔ 21 cells in 2 dimensions ('sex', 'age')</span></span>
<span><span class="co">## ✔ weights: yes</span></span>
<span><span class="co">## ── Tabulated / Perturbed countvars ─────────────────────────────────────────────</span></span>
<span><span class="co">## ☒ 'total' (perturbed)</span></span>
<span><span class="co">## ☒ 'cnt_highincome' (perturbed)</span></span>
<span><span class="co">## ── Tabulated / Perturbed numvars ───────────────────────────────────────────────</span></span>
<span><span class="co">## ☒ 'income' (perturbed)</span></span>
<span><span class="co">## ☒ 'savings' (perturbed)</span></span></code></pre>
<p>The <code>summary</code>-method shows some utility statistics for
already perturbed variables as shown below:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ┌──────────────────────────────────────────────┐</span></span>
<span><span class="co">## │Utility measures for perturbed count variables│</span></span>
<span><span class="co">## └──────────────────────────────────────────────┘</span></span>
<span><span class="co">## ── Distribution statistics of perturbations ────────────────────────────────────</span></span>
<span><span class="co">##          countvar Min Q10 Q20 Q30 Q40   Mean Median Q60 Q70 Q80 Q90 Q95 Q99 Max</span></span>
<span><span class="co">## 1:          total  -2  -1   0   0   0  0.333      1   1   1   1   1   1 1.0   1</span></span>
<span><span class="co">## 2: cnt_highincome  -3  -1  -1   0   0 -0.238      0   0   0   0   0   1 1.8   2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Distance-based measures ─────────────────────────────────────────────────────</span></span>
<span><span class="co">## ✔ Variable: 'total'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##       what    d1    d2    d3</span></span>
<span><span class="co">##  1:    Min 0.000 0.000 0.000</span></span>
<span><span class="co">##  2:    Q10 0.000 0.000 0.000</span></span>
<span><span class="co">##  3:    Q20 0.000 0.000 0.000</span></span>
<span><span class="co">##  4:    Q30 0.000 0.000 0.000</span></span>
<span><span class="co">##  5:    Q40 1.000 0.000 0.010</span></span>
<span><span class="co">##  6:   Mean 0.714 0.009 0.030</span></span>
<span><span class="co">##  7: Median 1.000 0.001 0.016</span></span>
<span><span class="co">##  8:    Q60 1.000 0.001 0.017</span></span>
<span><span class="co">##  9:    Q70 1.000 0.002 0.024</span></span>
<span><span class="co">## 10:    Q80 1.000 0.004 0.033</span></span>
<span><span class="co">## 11:    Q90 1.000 0.012 0.054</span></span>
<span><span class="co">## 12:    Q95 1.000 0.012 0.054</span></span>
<span><span class="co">## 13:    Q99 1.800 0.125 0.242</span></span>
<span><span class="co">## 14:    Max 2.000 0.154 0.289</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ✔ Variable: 'cnt_highincome'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##       what    d1    d2    d3</span></span>
<span><span class="co">##  1:    Min 0.000 0.000 0.000</span></span>
<span><span class="co">##  2:    Q10 0.000 0.000 0.000</span></span>
<span><span class="co">##  3:    Q20 0.000 0.000 0.000</span></span>
<span><span class="co">##  4:    Q30 0.000 0.000 0.000</span></span>
<span><span class="co">##  5:    Q40 0.000 0.000 0.000</span></span>
<span><span class="co">##  6:   Mean 0.611 0.038 0.073</span></span>
<span><span class="co">##  7: Median 0.000 0.000 0.000</span></span>
<span><span class="co">##  8:    Q60 0.200 0.001 0.007</span></span>
<span><span class="co">##  9:    Q70 1.000 0.008 0.044</span></span>
<span><span class="co">## 10:    Q80 1.000 0.039 0.099</span></span>
<span><span class="co">## 11:    Q90 2.000 0.078 0.189</span></span>
<span><span class="co">## 12:    Q95 2.150 0.154 0.287</span></span>
<span><span class="co">## 13:    Q99 2.830 0.374 0.574</span></span>
<span><span class="co">## 14:    Max 3.000 0.429 0.646</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ┌──────────────────────────────────────────────────┐</span></span>
<span><span class="co">## │Utility measures for perturbed numerical variables│</span></span>
<span><span class="co">## └──────────────────────────────────────────────────┘</span></span>
<span><span class="co">## ── Distribution statistics of perturbations ────────────────────────────────────</span></span>
<span><span class="co">##      vname        Min        Q10        Q20        Q30        Q40      Mean</span></span>
<span><span class="co">## 1:  income -100782.05 -75069.863 -37174.131 -30484.828 -18390.818 -1076.182</span></span>
<span><span class="co">## 2: savings  -10582.09  -4979.512  -4395.688  -3853.298  -3120.952  -707.683</span></span>
<span><span class="co">##       Median      Q60       Q70       Q80       Q90        Q95        Q99</span></span>
<span><span class="co">## 1: -4225.717 8620.411 18294.696 20435.876 63504.727 108249.601 136939.208</span></span>
<span><span class="co">## 2: -1381.985 2140.348  2932.545  3524.768  4841.112   4959.587   5159.561</span></span>
<span><span class="co">##           Max</span></span>
<span><span class="co">## 1: 144111.610</span></span>
<span><span class="co">## 2:   5209.554</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The package is <em>“work in progress”</em> and therefore, suggestions
and/or bugreports are welcome. Please feel free to file an issue at <a href="https://github.com/sdcTools/userSupport/issues" class="external-link"><strong>our issue
tracker</strong></a> or contribute to the package by filing a <a href="https://github.com/sdcTools/cellKey/pulls" class="external-link"><strong>pull
request</strong></a> against the master branch.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bernhard Meindl.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
